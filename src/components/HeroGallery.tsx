"use client";import Image from "next/image";import { AnimatePresence, motion } from "framer-motion";import { useEffect, useRef, useState } from "react";const SLIDE_MS = 5000;const SWIPE_THRESHOLD_PX = 40;const slides = [  { src: "/images/hero-slider/slide-1.jpg", alt: "Magnetic Selfie Screen in action 1", label: "Stage ready" },  { src: "/images/hero-slider/slide-2.jpg", alt: "Magnetic Selfie Screen in action 2", label: "Pop-up event" },  { src: "/images/hero-slider/slide-3.jpg", alt: "Magnetic Selfie Screen in action 3", label: "Venue setup" },  { src: "/images/hero-slider/slide-4.jpg", alt: "Magnetic Selfie Screen in action 4", label: "Night shoot" },  { src: "/images/hero-slider/slide-5.jpg", alt: "Magnetic Selfie Screen in action 5", label: "Crowd moment" },  { src: "/images/hero-slider/slide-6.jpg", alt: "Magnetic Selfie Screen in action 6", label: "Detail shot" },  { src: "/images/hero-slider/slide-7.jpg", alt: "Magnetic Selfie Screen in action 7", label: "Group snap" },];const variants = {  enter: (direction: number) => ({ x: direction > 0 ? 28 : -28, opacity: 0, scale: 0.99 }),  center: { x: 0, opacity: 1, scale: 1 },  exit: (direction: number) => ({ x: direction > 0 ? -28 : 28, opacity: 0, scale: 0.99 }),};export default function HeroGallery() {  const [index, setIndex] = useState(0);  const [direction, setDirection] = useState(1);  const [paused, setPaused] = useState(false);  const [progress, setProgress] = useState(0);  const timerRef = useRef<number | null>(null);  const rafRef = useRef<number | null>(null);  const startRef = useRef<number>(0);  const touchStartRef = useRef<number | null>(null);  const go = (step: number) => {    const move = step === 0 ? 1 : Math.sign(step);    setDirection(move);    startRef.current = performance.now();    setProgress(0);    setIndex((i) => (i + step + slides.length) % slides.length);  };  useEffect(() => {    startRef.current = performance.now();    if (timerRef.current !== null) window.clearTimeout(timerRef.current);    if (!paused) {      timerRef.current = window.setTimeout(() => go(1), SLIDE_MS);    }    return () => {      if (timerRef.current !== null) window.clearTimeout(timerRef.current);    };  }, [index, paused]);  useEffect(() => {    if (rafRef.current !== null) cancelAnimationFrame(rafRef.current);    if (paused) return;    const tick = () => {      const elapsed = performance.now() - startRef.current;      setProgress(Math.min(1, elapsed / SLIDE_MS));      rafRef.current = requestAnimationFrame(tick);    };    rafRef.current = requestAnimationFrame(tick);    return () => {      if (rafRef.current !== null) cancelAnimationFrame(rafRef.current);    };  }, [paused, index]);  const handleTouchStart = (e: React.TouchEvent<HTMLDivElement>) => {    touchStartRef.current = e.touches[0].clientX;    setPaused(true);  };  const handleTouchEnd = (e: React.TouchEvent<HTMLDivElement>) => {    setPaused(false);    const startX = touchStartRef.current;    touchStartRef.current = null;    if (startX === null) return;    const delta = e.changedTouches[0].clientX - startX;    if (Math.abs(delta) < SWIPE_THRESHOLD_PX) return;    go(delta > 0 ? -1 : 1);  };  const handleKeyDown = (e: React.KeyboardEvent<HTMLDivElement>) => {    if (e.key === "ArrowRight") go(1);    if (e.key === "ArrowLeft") go(-1);  };  return (    <div      className="relative w-full max-w-full max-w-[460px] md:max-w-[440px] ms-auto md:justify-self-end overflow-hidden"      onMouseEnter={() => setPaused(true)}      onMouseLeave={() => setPaused(false)}      onTouchStart={handleTouchStart}      onTouchEnd={handleTouchEnd}      onKeyDown={handleKeyDown}      tabIndex={0}      aria-label="Hero gallery carousel"    >      <div className="absolute inset-0 -z-10 blur-3xl bg-[radial-gradient(circle_at_20%_20%,rgba(107,140,255,.25),transparent_45%),radial-gradient(circle_at_80%_0%,rgba(255,79,216,.18),transparent_40%)]" />      <div className="relative overflow-hidden rounded-[24px] border border-white/10 bg-white/5 shadow-2xl backdrop-blur">        <div className="absolute inset-0 bg-gradient-to-b from-white/15 via-transparent to-black/50 pointer-events-none" />        <div className="absolute top-3 left-3 right-3 h-1.5 rounded-full bg-white/20 overflow-hidden">          <div className="h-full bg-white/90 transition-[width] duration-200" style={{ width: `${Math.round(progress * 100)}%` }} />        </div>        <div className="absolute top-3 left-3 flex items-center gap-2 text-[11px] uppercase tracking-[0.12em] text-white/70 font-semibold">          <span className="rounded-full bg-white/15 px-3 py-1">Live preview</span>          <span className="rounded-full bg-black/40 px-3 py-1 border border-white/10">Swipe or tap</span>        </div>        <AnimatePresence initial={false} custom={direction} mode="wait">          <motion.figure            key={slides[index].src}            custom={direction}            variants={variants}            initial="enter"            animate="center"            exit="exit"            transition={{ duration: 0.65, ease: [0.22, 1, 0.36, 1] }}            className="relative h-[360px] sm:h-[400px]"            style={{ ["--gallery-duration" as string]: `${SLIDE_MS}ms` }}          >            <Image              src={slides[index].src}              alt={slides[index].alt}              fill              priority              sizes="(min-width: 768px) 440px, 100vw"              className="object-cover kb-animate"            />            <figcaption className="absolute bottom-3 left-3 right-3 glass rounded-2xl px-4 py-3 text-sm text-white/90">              <div className="flex items-center gap-2">                <span className="inline-flex items-center rounded-full bg-white/15 px-3 py-1 text-xs font-semibold text-white/80">                  {slides[index].label}                </span>                <span className="text-white/70">Real sessions filmed with Magnetic Selfie Screen</span>              </div>            </figcaption>          </motion.figure>        </AnimatePresence>        <div className="absolute inset-y-0 flex items-center justify-between px-2">          <button            aria-label="Previous"            className="grid size-9 place-items-center rounded-full bg-black/35 text-white/90 hover:bg-black/55 border border-white/15"            onClick={() => go(-1)}          >            <span className="text-base">&lt;</span>          </button>          <button            aria-label="Next"            className="grid size-9 place-items-center rounded-full bg-black/35 text-white/90 hover:bg-black/55 border border-white/15"            onClick={() => go(1)}          >            <span className="text-base">&gt;</span>          </button>        </div>      </div>      <div className="mt-3 w-full max-w-full grid grid-cols-4 sm:grid-cols-5 md:grid-cols-7 gap-2 overflow-hidden">        {slides.map((slide, i) => {          const active = i === index;          return (            <button              key={slide.src}              aria-label={`Go to slide ${i + 1}`}              className={`group relative overflow-hidden rounded-xl border ${active ? "border-white/80 shadow-[0_8px_30px_rgba(0,0,0,0.35)]" : "border-white/10 hover:border-white/40"} transition-colors`}              onClick={() => go(i - index)}            >              <div className="absolute inset-0 bg-gradient-to-b from-black/0 via-black/20 to-black/50 opacity-0 group-hover:opacity-100 transition-opacity" />              <Image                src={slide.src}                alt={slide.alt}                width={80}                height={60}                className="h-full w-full object-cover"              />              {active && <div className="absolute inset-0 ring-2 ring-white/80 rounded-xl pointer-events-none" />}            </button>          );        })}      </div>    </div>  );}
